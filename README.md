# RSNA_data_preprocessing

![流程圖原始檔](https://viewer.diagrams.net/?tags=%7B%7D&highlight=000000&edit=_blank&layers=1&nav=1&title=rsna_data_preprocess.drawio#R7V1tb6O4Fv41lXY%2FBGHM68dOO5270s7ekUa6d3e%2FVDQhKRoCXKCddn%2F9tQkmYDvBUOyQhI40TRx6IOc85%2Fi82b6Bd9u3L5mfPn9NVkF0Y%2Birtxt4f2MYhq6b6Bceed%2BNAGDYu5FNFq6qsf3A9%2FCfoBrUq9GXcBXkrQuLJImKMG0PLpM4DpZFa8zPsuRn%2B7J1ErXvmvqbgBn4vvQjdvS%2F4ap43o26lr4f%2F1cQbp7JnYFefbL1ycXVQP7sr5KfjSH4%2BQbeZUlS7F5t3%2B6CCHOP8GX3dw8HPq0fLAviQuQPvN9%2Fxs7D65f47ut29dvff%2Ft%2F6ptFReXVj16qL1w9bPFOOICeO8Uvw23Jqk%2FPxTZCbwF6%2BRpkRYh4dRuFmxiNFUnaGP3dfwqib0keFmGCP31KiiLZogsi%2FMEnf%2FljkyUv8eouiZKsvBdclz%2FokvJmt3m6E6mORnzyZh2%2BBStyCXr%2FXBQYC7f4mxsPy1WsayFCwzqMV0GmLdEdjYeVX%2FjoFx7P0e8APWL5emGY6dviNYkwIx4MBNYHjJAgW%2FwTpgtguFoab1hGE66hLxq8NYYqxn8Jkm1QZO%2FoEvIpsDVr90e1Iri79z%2F3qLIrpDw3AEXG%2FArHm5r2XtToRSXtHpI3BST%2FIyiWzxX%2F0ySMiyD7%2FIq4kFfyryGNL1j5%2BTMWTPmmAZK8yJIfARFynMQYROswihpyt3T8j0CjgZllgG8qAio%2BFpOXIgpjdHdiHUooVZfUxAnEt28bbMa0ZL0OlwHCTrwM0iLXdphAF44ABcN0KSi4OoMECFkkQFlIsGYkTAQJwDgxFOxuKPx8Dovge%2Bov8fufiEmUjCkGPvl5uNRWyfJlizklhWs2h2scUyqNa845cs3QT8w1l8M1OyqwSUjwd26wz%2F7fS0I%2BWOSlj4imex3o6VupiuRz9GqDf38vkGvwaDwWmR%2FGhOpTRj7%2B5f63u39%2F%2FZX9gIyUbgB%2BBjJMSRMxvehp2qohxuDQxmobrlb4Np94iCndpdqyjgELW2AyAjokFykBhqcAGEFezLjogwve1KQaGCQm5CBjFb4OBIZOWL8fjIJ1cRg7ub9No%2BAxf3nahnmOfA9tmb82EFI%2BijSAlM92cni47BxssfDwHBYchjRw8ELZJjhE5SxnFqJA0jYj140dQz85dmBv7FSGumlIupECDiBlNMhleewvUHSW%2BcvMj0M%2FWjwH2yTLnhESF6ugQJEPNlj%2FhOmpsTiRic7T22aM5%2F4ApVAUyMsE8eoWpzYxGyMfzUHLtizaXArewuJP%2FBqp3e7dX9V1%2BPX9W%2BOy%2B%2FcuzgarVrqU5WuDcRYnmiBjWRD5RfjaTrLymFnd4RvOOTTyaZxwxmoTyZOXbBlUf9dMi3aTMinhFn62CQqGFJKB%2F964rMyL5L0eGloUYHY09%2FCpOfsBRPHyOyPZmzQLMEge0TP6j6twmWy19F3UW27DtCNCHkHXAWT4b%2FHU3dMMjldLg2I8jRdIuvTT%2BKlrLzKztPuoU9wV1V6WlCzt5dxJifYKJJca6Khm2TOGhqM5Y2GD0XeG1AFsjCY8XirjkoXHMJxWRnHZ7a3wIVqShWfwsg0XbZdZBwUO1T0OKcOUYpc5d6rUTqpdNnjpBgodc9VMQtUMQKMtbcj6cEprZkTwo2YluXmBZS3w%2FYUw8O0n2%2B6ZiOi64dN%2BoOydwE0TaZYsyx6L2rt%2F4mQNRJIJUpgznNAvt6WQv%2F3xBf2PFCv4dTTSPUoJczoGK5hNe3%2FQhox6q647GLz04EV7AqwnN9gT4JCS5Alw7qTEExDI2J28%2FK871KRpspOmyuK%2FwUtKTZ1pzqmZxssUjTuZMlO6Qtej9jR22cRdy2b3xMjzQqbsbhBCeerHXEID%2FqRUlUW%2B0xV89zQLDlHyt1iR4qc8Hfae8Hj3MAzrm8Nl5bNMDmNpziXQg81YEHqsl6O0BGocbseabctsWyZoW4K8mE2LgGlxTm1a4NUlUqHT9hwNUuPrGzxBjyZkaS5FS3IanKTbZJSPA5wnDJEQS4v8uE6yrV88skkTXGbOkmWQ51qYvsdPB1WdQpXqCrOpMwUQj9PbpLrCDAUi1MtSQNN2NM%2FW9z9mW42GlqW66NpyMhtdt7UUpDlgv0L0BYAIWsxcaumaDgeacoehZnqa66k15hIXXeRpFO4M%2BbSNNPTYhOQEjLR5dV6SifQLwWn%2FQzuuQ410B11PkpHuuK2rwEh7AiDCi67Tg9io1tH7T%2BRyQlHcCTLotc6Gw%2BqXp7JECwUKOCNnm4%2BLp5uZp8oxwyvJMZcJgzkDNK0MUGu9plga6FIzPx%2B1H8TZgS1LzNph3p4T0jJBHi%2BXcNjH6eqHJCsbyFoGvK5hv8rhPFc2WGwDbL1Ipa8jZDEBDENqJN%2FHYlvrvdZuNJLcnX6NGefeX8vK06RVVT40RpMdLxRV7KpCD2igbSFNk7WRlmlrkJMxJ5eOHwsKNJcq8VddYY5W7Nsbr1M5sGbXWs4JOWmHPOFB69gF3efaE15Ho5RDz7Dh86x95HX0uG%2BrqEQ3O8wfN2B1Cac1HQBD4%2BUGOckLaU6zyWuVG0kT8HJnSzRRe9Fyb3sBwOSInTeNyZO6gnLLUdZNxOcFtlP7XnW5a5jPC7xOUpJ9Xnt4evaorD7uCRv63sVtWjqTI1l5bq9ASDCvqepeU3Uce71yz4aruQ6nDCbPfRdYMqsi9OnBLqJCBpO4YfvFkT%2FBqyoCUxI7LQGLM1F2Wsgg0XWk0%2FOTl8GcaHhz%2BugSWcRqb5CPlFvmCFNthImltsBSW9w4n%2BIb534OMEe0aybQALWzAdug6x2YdqWFG%2B7oSxz32055yE1tFmgcD94cK9HgN9%2BCLETfDDs4Zxy8QNPRgIPJ7X4A5R5oruXtfyxnWFwDHUTIoUl7sNGKolOkJcc57ryluDxHfkBuwzXowJeb31DZkuPy%2BkymXeJoNHnTaQSXlyU0Ffqlrvo9yMdiJwA0OyE4OTvlr4a7NDd%2F9vDPzMOfnXsJxszwaGMGrNNXkHhJC7mTw4CufLYVQzdYH0VlK4En4KPIb1GxWL5wdryyoeIWFd6asona6NPPkHObxblNkbjNgqwwn7ssOuZJu7dVa8%2BRnLy%2B2gny8KKHD2uBcaktFr2Fvminv9jzD5U2WDgCOSo5DRYV4yaSowQNz%2BGdz3PxBotOUpITj85wj%2B2orMZosIDcBgve%2BgtpTpsjkCWa87ID87KOuEGslGPBiW9U5mAdgX4bFUnDHpwj2mS3rQzLSLXpwq6zpybkjZ8%2BGJq7As4xICqjoTkQGtmQmdMKhDzZB1acg0cMTcaNHbpfkIBzPdYxCOydTAUrMIHOm%2FrGRMy0lmA6zEJXc%2Bg2JRxSik84AToviTtyDDwx%2BTGnT5qmOVB%2BDCkoSbc5D121FkvWbTaaXqaP4dbfBGSLJwosqvdyshBnSK3%2ByGYztdFVc6CbzobZgNWrKArT%2FJD70WCTn6e7KHYdvmHW0mH0yg%2Fc9ZJxi9An9tINntbjcBq4Nn0gk2FyjmbgNWPLSmcAnXVXOAbsvBhtWo5mU6vRXE4FWSmjOSdvw%2FNntK7ZRtuAA44DrpbRrDtlnjujbQ9okDLSNpv9V8zoq3N9gAvozWmtgSspUVTaRUq263rkVNvzOrL7JZ5P425AtI0qCBgzobRICHqe4HkBZsIGkA5ryLZdfc0Eh5RBkRopQuLcyTEo6cuIkK7vjFB7vyNGPZcP3NyeJQU8itRo8GAeumr5kAwPoxc8Ove7i9Hz7NZUWeTtX9WV5Zv9eqryXeeedzv2HvkG5HmnAj5m62bTHWib2GNj63bTscHHPLQFjJ7PRv2FLLhe3TmHHEANPecQkyLb%2F9ezHfVAvRE1utsscljh3AEi4dhix2aOBoFs%2Bkxp%2BwdQcJ7gpbUtlMnvfG5cOKPGheZip8VOfv1aGIQkfX4dDP1NGFOwBKT22TqcWWmAbswtjaeZ0CyPDrkBOSrsdBPavGx3ntAufkLDnXgDJ7J5FjMs1hGfwCx2dWlmx7U1h%2BritgeWozi06nMXR2%2FFYR%2B7Wq4hNzcjcojq7OdI8HM8p53UAbwN7pV6OaQoNkNBNRSMdnnSsDhrGNVCQaDAMENBilVw6IrS6cEgkL6fwSABDEAnejgdLHRtzyHSHrMLBHLkOhUvqbIoYSK9KJ7TbsI0ILtNJ293dHlBQufRjOIyLTI%2FztflJ1clVKAbjN0%2BvVznFOap7DbTEjkBy92VwxTX8ihBQrg%2BFSctIUcUHNa5a0UqzuZ3qoNoL1UMHmAOGCSn2p3M0HL3wTuuWmXKUl4emsniXm9e1rM8uoUTsA0SigHTdZagcsBc6Gr6MdDCObhTMVr67Sh17kuhPXoTFrIQs2%2F6niYELYqQ7LUk3O3frkdw0BgqOOp0cYaQdMHNRZETpT%2BphBdvqiayUGR8%2B52XeHE6bDmaN%2FD8EEaNObSka%2FJc05qIJnPcKMWaPHovRA2Fo7tOTESz3e5tYYQVm4nBoeAy3b5tEexDkzvJ7YoQOd7wkrHCCLjeT3QErAh6cx%2FHCnnoQ8%2FGQVf1bJLR1W891Nn7FK6rmXRv01A4cWgBipZsn8Lqt8XDuYsP6MxiNqZMIR6Sd5KSLr1ry6aw%2BfIzFt51ZVSAbo5nOrnElAvwusJpZDtRzDuaADnElAtwvDLygdPCrqKa7Dk6s9PRqcuYtkDQs2cEOMCqhmw4YmA2BHM%2B39qfxQMkcQ67jNdS12mbKQjutj90sDMejy1eEqJdwyuLdQ31ATLWepmCa72cwLcDnX2CP%2F7zECHpjLGwq1PFxVU3C9BXrA7TqJN5pQytTzfWPab1UiQVh%2FtYj1E0nu4Qq3c%2FbODRVXkOHbDZ7OgyidfhRkvfj6i%2Boj1YHXpjUJvlFwBefZWaTVjJ1o4NnumsC3NeOykiz4LeSZEzG420kSJ6myXYmOz9EpyN%2FpqsAnzF%2FwE%3D)

![流程圖](https://github.com/MingChin-Kao/RSNA_data_preprocessing/blob/main/images/flow_chart.png)

### Step1. 從 [Kaggle](https://www.kaggle.com/competitions/rsna-intracranial-hemorrhage-detection/overview) 下載檔案，並解壓縮得到以下資料夾

---

- stage_2_test/ (DICOM File)
- stage_2_train/ (DICOM File)
- stage_2_sample_submission.csv
- stage_2_train.csv

### Step2. 環境建置

---

下載此 repo 並透過 requirements.txt 進行環境建置

- Python=3.8

```bash
pip install -r requirements.txt
```

### Step3. 設定 [config.py](http://config.py) 檔

---

於 [config.py](http://config.py) 檔案中設定 `RSNA_ROOT_DIR` 及 `ZIP_FILE` 路徑

- `RSNA_ROOT` ⇒ Step1 下載下來解壓縮的資料夾位置
- `ZIP_FILE` ⇒ Step1 下載下來的 zip 檔位置

### Step4. 執行 [config.py](http://config.py) 檔案

---

執行 [config.py](http://config.py) 檔案用來建立所需資料夾

```bash
python config.py
```

### Step5. 執行 prepare_meta_dicom.py

---

- 將所有 DICOM 轉成 PNG 檔
- 產生 train_metadata.csv
- 產生 test_metadata.csv

### Step6. 執行 efficient_data_format_preprocess.ipynb

---

- 透過 efficient_data_format_preprocess.ipynb 將csv資料轉成 efficientnet 訓練需要的格式
- 產生 train.csv

### Step7. 執行 split_data.ipynb

---

- 透過 split_data.ipynb 將訓練資料進行切割

### Step8. 執行 split_data.ipynb

---

- 透過 cp_image.ipynb 將客戶端對應的資料複製出來
- 將每個 site 所屬的照片複製一份至 /fl/site_images/ 資料夾中
- 將 test_data 所屬的圖片複製一份至 /fl/site_images/ 資料夾中

### Training

---

[點我](https://www.kaggle.com/code/taindow/pytorch-efficientnet-b0-benchmark/notebook?scriptVersionId=21235680)
